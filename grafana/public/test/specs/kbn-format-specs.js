/*! grafana - v2.2.0-pre1 - 2015-09-02
 * Copyright (c) 2015 Torkel Ödegaard; Licensed Apache-2.0 */

define(["kbn"],function(a){"use strict";function b(b,c,d,e,f){describe("value format: "+b,function(){it("should translate "+c+" as "+f,function(){var g=e-Math.floor(Math.log(d)/Math.LN10),h=a.valueFormats[b](c,e,g);expect(h).to.be(f)})})}b("ms",.0024,5e-4,4,"0.0024 ms"),b("ms",100,1,0,"100 ms"),b("ms",1250,10,0,"1.25 s"),b("ms",1250,300,0,"1.3 s"),b("ms",65150,1e4,0,"1.1 min"),b("ms",6515e3,15e5,0,"1.8 hour"),b("ms",6515e5,15e7,0,"8 day"),b("none",2.75e-10,0,10,"3e-10"),b("none",0,0,2,"0"),b("bytes",-1.57e308,-1.57e308,2,"NA"),b("ns",25,1,0,"25 ns"),b("ns",2558,50,0,"2.56 µs"),describe("kbn.toFixed and negative decimals",function(){it("should treat as zero decimals",function(){var b=a.toFixed(186.123,-2);expect(b).to.be("186")})}),describe("kbn ms format when scaled decimals is null do not use it",function(){it("should use specified decimals",function(){var b=a.valueFormats.ms(10000086.123,1,null);expect(b).to.be("2.8 hour")})}),describe("kbn kbytes format when scaled decimals is null do not use it",function(){it("should use specified decimals",function(){var b=a.valueFormats.kbytes(1e7,3,null);expect(b).to.be("9.537 GiB")})}),describe("kbn roundValue",function(){it("should should handle null value",function(){var b=a.roundValue(null,2);expect(b).to.be(null)})}),describe("calculateInterval",function(){it("1h 100 resultion",function(){var b={from:a.parseDate("now-1h"),to:a.parseDate("now")},c=a.calculateInterval(b,100,null);expect(c).to.be("30s")}),it("10m 1600 resolution",function(){var b={from:a.parseDate("now-10m"),to:a.parseDate("now")},c=a.calculateInterval(b,1600,null);expect(c).to.be("100ms")}),it("fixed user interval",function(){var b={from:a.parseDate("now-10m"),to:a.parseDate("now")},c=a.calculateInterval(b,1600,"10s");expect(c).to.be("10s")}),it("short time range and user low limit",function(){var b={from:a.parseDate("now-10m"),to:a.parseDate("now")},c=a.calculateInterval(b,1600,">10s");expect(c).to.be("10s")}),it("large time range and user low limit",function(){var b={from:a.parseDate("now-14d"),to:a.parseDate("now")},c=a.calculateInterval(b,1e3,">10s");expect(c).to.be("30m")})}),describe("relative time to date parsing",function(){it("should handle negative time",function(){var b=a.parseDateMath("-2d",new Date(2014,1,5));expect(b.getTime()).to.equal(new Date(2014,1,3).getTime())}),it("should handle today",function(){var b=a.parseDate("today"),c=new Date;c.setHours(0,0,0,0),expect(b.getTime()).to.equal(c.getTime())}),it("should handle multiple math expressions",function(){var b=a.parseDateMath("-2d-6h",new Date(2014,1,5));expect(b.toString()).to.equal(new Date(2014,1,2,18).toString())}),it("should return false when invalid expression",function(){var b=a.parseDateMath("2",new Date(2014,1,5));expect(b).to.equal(!1)})})});