/*! grafana - v4.0.0-1478693311beta1 - 2016-11-09
 * Copyright (c) 2016 Torkel Ã–degaard; Licensed Apache-2.0 */

System.register(["app/core/config","lodash","jquery","app/core/profiler","app/core/core"],function(a){var b,c,d,e,f,g,h,i,j,k;return{setters:[function(a){b=a},function(a){c=a},function(a){d=a},function(a){e=a},function(a){f=a}],execute:function(){g=25,h=9,i=5,j=2,k=function(){function a(a,c){var d=this;this.$injector=c,this.$scope=a,this.$timeout=c.get("$timeout"),this.editorTabIndex=0,this.events=new f.Emitter,this.timing={};var e=b["default"].panels[this.panel.type];e&&(this.pluginId=e.id,this.pluginName=e.name),a.$on("refresh",function(){return d.refresh()}),a.$on("render",function(){return d.render()}),a.$on("$destroy",function(){d.events.emit("panel-teardown"),d.events.removeAllListeners()})}return a.prototype.init=function(){this.calculatePanelHeight(),this.publishAppEvent("panel-initialized",{scope:this.$scope}),this.events.emit("panel-initialized")},a.prototype.renderingCompleted=function(){e.profiler.renderingCompleted(this.panel.id,this.timing)},a.prototype.refresh=function(){this.events.emit("refresh",null)},a.prototype.publishAppEvent=function(a,b){this.$scope.$root.appEvent(a,b)},a.prototype.changeView=function(a,b){this.publishAppEvent("panel-change-view",{fullscreen:a,edit:b,panelId:this.panel.id})},a.prototype.viewPanel=function(){this.changeView(!0,!1)},a.prototype.editPanel=function(){this.changeView(!0,!0)},a.prototype.exitFullscreen=function(){this.changeView(!1,!1)},a.prototype.initEditMode=function(){var a=this;this.editorTabs=[],this.addEditorTab("General","public/app/partials/panelgeneral.html"),this.editModeInitiated=!0,this.events.emit("init-edit-mode",null);var b=(this.$injector.get("$routeParams").tab||"").toLowerCase();b&&this.editorTabs.forEach(function(c,d){c.title.toLowerCase()===b&&(a.editorTabIndex=d)})},a.prototype.changeTab=function(a){this.editorTabIndex=a;var b=this.$injector.get("$route");b.current.params.tab=this.editorTabs[a].title.toLowerCase(),b.updateParams()},a.prototype.addEditorTab=function(a,b,d){var e={title:a,directiveFn:b};c["default"].isString(b)&&(e.directiveFn=function(){return{templateUrl:b}}),d?this.editorTabs.splice(d,0,e):this.editorTabs.push(e)},a.prototype.getMenu=function(){var a=[];return a.push({text:"View",click:"ctrl.viewPanel(); dismiss();"}),a.push({text:"Edit",click:"ctrl.editPanel(); dismiss();",role:"Editor"}),this.fullscreen||a.push({text:"Duplicate",click:"ctrl.duplicate()",role:"Editor"}),a.push({text:"Share",click:"ctrl.sharePanel(); dismiss();"}),a},a.prototype.getExtendedMenu=function(){var a=[{text:"Panel JSON",click:"ctrl.editPanelJson(); dismiss();"}];return this.events.emit("init-panel-actions",a),a},a.prototype.otherPanelInFullscreenMode=function(){return this.dashboard.meta.fullscreen&&!this.fullscreen},a.prototype.calculatePanelHeight=function(){if(this.fullscreen){var a=d["default"](window).height(),b=Math.floor(.4*a),e=Math.floor(.8*a);this.containerHeight=this.editMode?b:e}else this.containerHeight=this.panel.height||this.row.height,c["default"].isString(this.containerHeight)&&(this.containerHeight=parseInt(this.containerHeight.replace("px",""),10));this.height=this.containerHeight-(j+i+(this.panel.title?g:h))},a.prototype.render=function(a){this.otherPanelInFullscreenMode()||(this.calculatePanelHeight(),this.timing.renderStart=(new Date).getTime(),this.events.emit("render",a))},a.prototype.toggleEditorHelp=function(a){return this.editorHelpIndex===a?void(this.editorHelpIndex=null):void(this.editorHelpIndex=a)},a.prototype.duplicate=function(){this.dashboard.duplicatePanel(this.panel,this.row)},a.prototype.updateColumnSpan=function(a){var b=this;this.panel.span=Math.min(Math.max(Math.floor(this.panel.span+a),1),12),this.row.panelSpanChanged(),this.$timeout(function(){b.render()})},a.prototype.removePanel=function(){this.row.removePanel(this.panel)},a.prototype.editPanelJson=function(){this.publishAppEvent("show-json-editor",{object:this.panel,updateHandler:this.replacePanel.bind(this)})},a.prototype.replacePanel=function(a,b){var d=this,e=(this.row,c["default"].indexOf(this.row.panels,b));this.row.panels.splice(e,1),this.$timeout(function(){a.id=b.id,a.span=b.span,d.row.panels.splice(e,0,a)})},a.prototype.sharePanel=function(){var a=this.$scope.$new();a.panel=this.panel,a.dashboard=this.dashboard,this.publishAppEvent("show-modal",{src:"public/app/features/dashboard/partials/shareModal.html",scope:a})},a.prototype.openInspector=function(){var a=this.$scope.$new();a.panel=this.panel,a.dashboard=this.dashboard,a.inspector=d["default"].extend(!0,{},this.inspector),this.publishAppEvent("show-modal",{src:"public/app/partials/inspector.html",scope:a})},a}(),a("PanelCtrl",k)}}});