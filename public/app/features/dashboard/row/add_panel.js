/*! grafana - v4.0.0-1478693311beta1 - 2016-11-09
 * Copyright (c) 2016 Torkel Ã–degaard; Licensed Apache-2.0 */

System.register(["lodash","app/core/config","app/core/core"],function(a){function b(){return{restrict:"E",templateUrl:"public/app/features/dashboard/row/add_panel.html",controller:f,bindToController:!0,controllerAs:"ctrl",scope:{rowCtrl:"="}}}var c,d,e,f;return a("addPanelDirective",b),{setters:[function(a){c=a},function(a){d=a},function(a){e=a}],execute:function(){f=function(){function a(a,b,e){this.$scope=a,this.$timeout=b,this.$rootScope=e,this.row=this.rowCtrl.row,this.dashboard=this.rowCtrl.dashboard,this.allPanels=c["default"].orderBy(c["default"].map(d["default"].panels,function(a){return a}),"sort"),this.panelHits=this.allPanels,this.activeIndex=0}return a.$inject=["$scope","$timeout","$rootScope"],a.prototype.keyDown=function(a){if(27===a.keyCode)return void(this.rowCtrl.dropView=0);if(40!==a.keyCode&&39!==a.keyCode||this.moveSelection(1),38!==a.keyCode&&37!==a.keyCode||this.moveSelection(-1),13===a.keyCode){var b=this.panelHits[this.activeIndex];b&&this.addPanel(b)}},a.prototype.panelSearchBlur=function(){},a.prototype.moveSelection=function(a){var b=this.panelHits.length,c=this.activeIndex+a;this.activeIndex=(c%=b)<0?c+b:c},a.prototype.panelSearchChanged=function(){for(var a,b=this.allPanels.slice(),c=[],d=[],e=this.panelSearch.toLowerCase();a=b.shift();){var f=a.name.toLowerCase();0===f.indexOf(e)?c.push(a):f.indexOf(e)!==-1&&d.push(a)}this.panelHits=c.concat(d),this.activeIndex=0},a.prototype.addPanel=function(a){var b=this,c=12,e=12-this.row.span,f={id:null,title:d["default"].new_panel_title,error:!1,span:e<c&&e>0?e:c,editable:!0,type:a.id,isNew:!0};this.rowCtrl.closeDropView(),this.dashboard.addPanel(f,this.row),this.$timeout(function(){b.$rootScope.$broadcast("render")})},a}(),a("AddPanelCtrl",f),e.coreModule.directive("dashRowAddPanel",b)}}});