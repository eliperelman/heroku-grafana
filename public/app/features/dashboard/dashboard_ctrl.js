/*! grafana - v4.0.0-1478693311beta1 - 2016-11-09
 * Copyright (c) 2016 Torkel Ã–degaard; Licensed Apache-2.0 */

System.register(["app/core/config","angular","app/core/core_module"],function(a){var b,c,d,e;return{setters:[function(a){b=a},function(a){c=a},function(a){d=a}],execute:function(){e=function(){function a(a,d,e,f,g,h,i,j,k,l,m,n,o){this.$scope=a,this.$rootScope=d,a.editor={index:0};var p;a.setupDashboard=function(b){try{a.setupDashboardInternal(b)}catch(c){a.onInitFailed(c,"Dashboard init failed",!0)}},a.setupDashboardInternal=function(b){var c=i.create(b.dashboard,b.meta);i.setCurrent(c),f.init(c),h.init(c,b.alerts),g.init(c)["catch"](a.onInitFailed.bind(this,"Templating init failed",!1))["finally"](function(){k.init(c,g),k.process(),j.init(c,a),a.dashboard=c,a.dashboardMeta=c.meta,a.dashboardViewState=l.create(a),e.setupDashboardBindings(a,c),a.dashboard.updateSubmenuVisibility(),a.setWindowTitleAndTheme(),a.appEvent("dashboard-initialized",a.dashboard)})["catch"](a.onInitFailed.bind(this,"Dashboard init failed",!0))},a.onInitFailed=function(b,c,d){console.log(b,d),d.data&&d.data.message?d.message=d.data.message:d.message||(d={message:d.toString()}),a.appEvent("alert-error",[b,d.message]),c&&!a.loadedFallbackDashboard&&(a.loadedFallbackDashboard=!0,a.setupDashboard({dashboard:{title:"Dashboard Init failed"}}))},a.templateVariableUpdated=function(){k.process()},a.setWindowTitleAndTheme=function(){window.document.title=b["default"].window_title_prefix+a.dashboard.title},a.broadcastRefresh=function(){d.$broadcast("refresh")},a.addRowDefault=function(){a.dashboard.addEmptyRow()},a.showJsonEditor=function(b,c){var e=d.$new();e.object=c.object,e.updateHandler=c.updateHandler,a.appEvent("show-dash-editor",{src:"public/app/partials/edit_json.html",scope:e})},a.registerWindowResizeEvent=function(){c["default"].element(window).bind("resize",function(){o.cancel(p),p=o(function(){a.$broadcast("render")},200)}),a.$on("$destroy",function(){c["default"].element(window).unbind("resize"),a.dashboard.destroy()})},a.timezoneChanged=function(){d.$broadcast("refresh")}}return a.$inject=["$scope","$rootScope","keybindingSrv","timeSrv","variableSrv","alertingSrv","dashboardSrv","unsavedChangesSrv","dynamicDashboardSrv","dashboardViewStateSrv","contextSrv","alertSrv","$timeout"],a.prototype.init=function(a){this.$scope.onAppEvent("show-json-editor",this.$scope.showJsonEditor),this.$scope.onAppEvent("template-variable-value-updated",this.$scope.templateVariableUpdated),this.$scope.setupDashboard(a),this.$scope.registerWindowResizeEvent()},a}(),a("DashboardCtrl",e),d["default"].controller("DashboardCtrl",e)}}});